---
// Full-screen code rain with procedural curling. Canvas + vanilla JS.
---
<canvas id="code-rain-canvas" class="code-rain" aria-hidden="true"></canvas>

<script>
  (function () {
    const CHARS = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@#$%^&*()_+-=[]{}|;:',.<>?/\\";
    const canvas = document.getElementById("code-rain-canvas");
    if (!canvas) return;

    const ctx = canvas.getContext("2d");
    if (!ctx) return;

    let width = 0;
    let height = 0;
    let columns = [];
    let mouse = { x: 0, y: 0 };
    let time = 0;

    const LAYERS = [
      { count: 55, fontSize: 10, opacity: 0.08, speed: 0.4, amplitude: 12, frequency: 0.018, length: 22 },
      { count: 35, fontSize: 14, opacity: 0.18, speed: 0.7, amplitude: 22, frequency: 0.014, length: 18 },
      { count: 22, fontSize: 18, opacity: 0.35, speed: 1.1, amplitude: 35, frequency: 0.01, length: 14 },
    ];

    function initColumns() {
      columns = [];
      LAYERS.forEach((layer, layerIndex) => {
        const step = width / (layer.count + 1);
        for (let i = 0; i < layer.count; i++) {
          columns.push({
            baseX: step * (i + 1),
            yOffset: Math.random() * height,
            speed: layer.speed,
            phase: Math.random() * Math.PI * 2,
            amplitude: layer.amplitude,
            frequency: layer.frequency,
            fontSize: layer.fontSize,
            opacity: layer.opacity,
            length: layer.length,
            charHeight: layer.fontSize * 1.35,
          });
        }
      });
    }

    function resize() {
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width * dpr;
      canvas.height = height * dpr;
      canvas.style.width = width + "px";
      canvas.style.height = height + "px";
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      initColumns();
    }

    function draw() {
      time += 0.016;
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, width, height);

      columns.forEach((col) => {
        const mouseInfluence = (mouse.x - col.baseX) * 0.012;
        const amp = Math.max(5, col.amplitude + mouseInfluence);

        ctx.font = `600 ${col.fontSize}px "JetBrains Mono", "SF Mono", Consolas, monospace`;
        ctx.globalAlpha = col.opacity;

        for (let i = col.length - 1; i >= 0; i--) {
          const y = (col.yOffset + i * col.charHeight) % (height + col.length * col.charHeight) - col.charHeight;
          const x = col.baseX + amp * Math.sin(col.phase + y * col.frequency + time * 0.3);
          const charIndex = Math.floor((col.yOffset * 0.1 + i) * 7) % CHARS.length;
          const c = CHARS[Math.abs(charIndex)];
          const head = i === 0;
          ctx.fillStyle = head ? "rgba(255,255,255,0.98)" : "rgba(180,220,255,0.85)";
          ctx.globalAlpha = col.opacity * (head ? 1.25 : Math.max(0.3, 1 - i / col.length * 0.5));
          ctx.fillText(c, x, y);
        }

        col.yOffset += col.speed;
        if (col.yOffset > height + col.length * col.charHeight) col.yOffset = 0;
      });

      ctx.globalAlpha = 1;
      requestAnimationFrame(draw);
    }

    window.addEventListener("resize", resize);
    window.addEventListener("mousemove", (e) => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
    });
    window.addEventListener("mouseleave", () => {
      mouse.x = width / 2;
      mouse.y = height / 2;
    });

    resize();
    mouse.x = width / 2;
    mouse.y = height / 2;
    draw();
  })();
</script>

<style>
  .code-rain {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
    display: block;
  }
</style>
